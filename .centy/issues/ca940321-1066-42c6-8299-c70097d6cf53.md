---
displayNumber: 184
status: in-progress
priority: 2
createdAt: 2026-02-11T12:00:00.000000+00:00
updatedAt: 2026-02-15T16:16:23.805278+00:00
---

# Add timeout for interactive/hanging commands

## Problem

Several places in the CLI execute commands synchronously or spawn processes with inherited stdio, with no timeout protection. If a command waits for interactive input (stdin) or hangs for any other reason, the CLI blocks indefinitely with no way to recover.

### Affected areas

1. **`execSync` calls** - e.g. daemon installation in `src/lib/start/handle-missing-daemon.ts` uses `execSync(installCmd, { stdio: 'inherit' })` with no timeout
2. **`spawnSync` calls** - e.g. Bun re-exec in `bin/run.js` with `stdio: 'inherit'` and no timeout
3. **Readline prompts** - `src/utils/create-prompt-interface.ts` creates interactive prompts with no inactivity timeout; if stdin never provides input, the process hangs forever
4. **Foreground daemon spawn** - `src/lib/start/start-foreground.ts` spawns with `stdio: 'inherit'` and blocks until exit with no timeout
5. **launchctl commands** - `src/lib/autostart/launchd.ts` runs `execSync` launchctl commands with no timeout

## Expected Behavior

- Commands that could hang should have a configurable timeout (with sensible defaults)
- When a timeout is reached, the process should be killed and a clear error message displayed
- Interactive prompts should time out after a period of inactivity

## Suggested Approach

- Add a `timeout` option to `execSync`/`spawnSync` calls where applicable
- For spawned processes, use `setTimeout` + `child.kill()` pattern (similar to what exists in `runtime-detection.integration.spec.ts`)
- For readline prompts, add an inactivity timeout that auto-closes the interface
- Consider a global CLI timeout flag (e.g. `--timeout <ms>`) for operations that should not run indefinitely

## Reference

The gRPC layer already has proper timeout handling via `grpc-config.ts` (`DEFAULT_GRPC_TIMEOUT_MS`, `LONG_GRPC_TIMEOUT_MS`) and `grpc-utils.ts` (`createCallOptions`, `callWithDeadline`). The same pattern should be extended to process execution.
